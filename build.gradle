/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
// Top-level build file where you can add configuration options common to all sub-projects/modules.
buildscript {
    repositories {
        google()
        gradlePluginPortal()
        maven { url 'https://artifactory-bluemix.kp.org/artifactory/mvn-remote' }
        maven { url 'https://artifactory-fof.appl.kp.org/artifactory/mcoe_release' }
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:4.2.1'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.21"
        classpath 'com.google.gms:google-services:4.3.10'  // Google Services plugin
        classpath 'com.google.firebase:perf-plugin:1.4.0'  // Performance Monitoring plugin
        classpath 'com.google.firebase:firebase-crashlytics-gradle:2.7.1'
    }
}

plugins {
    id "org.sonarqube" version "${sonarqubePluginVersion}"
    id "com.vanniktech.android.junit.jacoco" version "${jacocoAndroidPluginVersion}"
    id "org.owasp.dependencycheck" version "${dependencyCheckVersion}"
}

sonarqube {
    properties {
        property "sonar.exclusions", '**/*png,**/*.cer,**/R.*,**/R$*.*,**/*$$*,**/*$ViewInjector*.*,**/*$ViewBinder*.*,**/BuildConfig.*,**/*$Lambda$*.*,**/*Dagger*.*,**/*MembersInjector*.*,**/*_Provide*Factory*.*'

        property "sonar.coverage.jacoco.xmlReportPaths", "$projectDir/app/build/reports/jacoco/allLowerEnvDevDebug/jacoco.xml"
        property "sonar.junit.reportPaths", "$projectDir/app/build/test-results/testAllLowerEnvDevDebugUnitTest"

        property "sonar.dependencyCheck.htmlReportPath", "$projectDir/app/build/reports/dependency-check-report.html"
        property "sonar.dependencyCheck.xmlReportPath", "$projectDir/app/build/reports/dependency-check-report.xml"
        property "sonar.dependencyCheck.jsonReportPath", "$projectDir/app/build/reports/dependency-check-report.json"
    }
}
junitJacoco {
    jacocoVersion = "${jacocoVersion}"
    includeNoLocationClasses = true // to include robolectric test coverage
}
// only run dependencyCheck on the 'app' project
tasks.sonarqube.dependsOn 'sonarqubeDependencies'

task sonarqubeDependencies {
    dependsOn ':app:dependencyCheckAnalyze'
    dependsOn ':app:lintAllLowerEnvDevDebug'
    dependsOn ':app:jacocoTestReportAllLowerEnvDevDebug'
    // no kotlin so no detekt
}

allprojects {
    repositories {
        google()
        maven { url 'https://artifactory-bluemix.kp.org/artifactory/mvn-remote' }
        maven { url 'https://jitpack.io' }
        maven { url 'https://artifactory-fof.appl.kp.org/artifactory/mcoe_release' }
    }
}
